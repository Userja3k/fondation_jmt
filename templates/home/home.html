{% extends 'base.html' %}
{% load static %}
{% load home_extras %}

{% block title %}Fondation JMT - Accueil{% endblock %}

{% block content %}
    <!-- Hero section with blurred background -->
    <section class="hero" style="position: relative; display: flex; flex-direction: column; align-items: center;">
        <div class="hero-content" style="order: 1;">
            <h1 class="gradient-text">Bienvenue</h1>
            <p>La Fondation JMT vous présente une plateforme pour repandre la Parole du Christ et vous presenter les potentiels des jeunes dévoués dans l'apprentissage et la présentation de la Bonne Nouvelle.</p>
        </div>
        {% if special_events %}
        <section class="section special-event" style="order: 2; background-color: #d0f0c0; width: 300px; padding: 20px; margin-top: 20px; border-radius: 8px; color: #064e03; margin-left: auto; margin-right: auto;">
            {% with event=special_events.0 %}
            <div style="text-align: center; font-weight: bold; font-size: 1.2rem; margin-bottom: 10px;">
                Événement spécial
            </div>
            <hr>
            <div style="text-align: center; font-size: 1.5rem; font-weight: 600; margin: 10px 0;">
                {{ event.title }}
            </div>
            <hr>
            <div style="text-align: center; margin-top: 10px;">
                <ul style="list-style: none; padding: 0; margin: 0;">
                    <li>{{ event.theme }}</li>
                    <li>{{ event.location }}</li>
                    <li>{{ event.date|date:"l j F Y" }} à {{ event.time|time:"H:i" }}</li>
                </ul>
            </div>
            {% endwith %}
        </section>
        {% endif %}
    </section>
    
    <div class="container">
        <!-- Weekly service section -->
        {% if culte_semaine %}
            <section class="section culte-de-la-semaine">
                <h5>CULTE DE LA SEMAINE</h5>
                <p><strong>{{ culte_semaine.date|date:"l j F" }}</strong></p>
                <h3>{{ culte_semaine.title }}</h3>
                <p>{{ culte_semaine.location }} — {{ culte_semaine.time|time:"H:i" }}</p>
            </section>
        {% endif %}
        
        <!-- Homepage sections -->
        {% for section in sections %}
            <section class="section">
                <h2 class="section-title">{{ section.title }}</h2>
                
                <div class="carousel">
                    <div class="carousel-inner">
                        {% if section.section_type == 'cultes' %}
                            {% for culte in section_content|get_item:section.id %}
                                <div class="carousel-item">
                                    <div class="card">
                                        <img src="{{ culte.miniature.url }}" alt="{{ culte.title }}" class="card-image">
                                        <div class="card-content">
                                            <h3 class="card-title">{{ culte.title }}</h3>
                                            <p class="card-text">{{ culte.description_main|truncatechars:100 }}</p>
                                            <p class="card-text">{{ culte.description_secondary|truncatechars:100 }}</p>
                                            <div class="videos">
                                                {% for video in culte.videos.all %}
                                                    <a href="{{ video.url }}" target="_blank" class="video-link">
                                                        {{ video.title }} (
                                                        {% if video.is_song %}
                                                            Chanson
                                                        {% else %}
                                                            Prédication
                                                        {% endif %}
                                                        )
                                                    </a><br>
                                                {% endfor %}
                                            </div>
                                            
                                            <a href="#" class="card-link">Voir plus</a>
                                        </div>
                                    </div>
                                </div>
                            {% empty %}
                                <p>Aucun culte disponible pour le moment.</p>
                            {% endfor %}
                        {% elif section.section_type == 'evenements' %}
                            {% for event in section_content|get_item:section.id %}
                                <div class="carousel-item">
                                    <div class="card">
                                        <img src="{{ event.image.url }}" alt="{{ event.title }}" class="card-image">
                                        <div class="card-content">
                                            <h3 class="card-title">{{ event.title }}</h3>
                                            <p class="card-text">{{ event.description|truncatechars:100 }}</p>
                                            <a href="{% url 'news:event_detail' event.id %}" class="card-link">Voir plus</a>
                                        </div>
                                    </div>
                                </div>
                            {% empty %}
                                <p>Aucun événement disponible pour le moment.</p>
                            {% endfor %}
                        {% elif section.section_type == 'theologie' %}
                            {% for course in section_content|get_item:section.id %}
                                <div class="carousel-item theology-course">
                                    <div class="card theology-card">
                                        <img src="{{ course.image.url }}" alt="{{ course.title }}" class="card-image theology-image">
                                        <div class="card-content theology-content">
                                            <h3 class="card-title">{{ course.title }}</h3>
                                            <p class="card-text">{{ course.description|truncatechars:100 }}</p>
                                            <a href="{% url 'theology:theology_detail' course.id %}" class="card-link">Voir plus</a>
                                        </div>
                                    </div>
                                </div>
                            {% empty %}
                                <p>Aucun cours disponible pour le moment.</p>
                            {% endfor %}
                        {% endif %}
                    </div>
                </div>
                
                {% if section.section_type == 'cultes' %}
                    <div class="text-center mt-4">
                        <a href="{% url 'archive:archive_list' %}" class="btn">Voir tous les cultes</a>
                    </div>
                {% elif section.section_type == 'evenements' %}
                    <div class="text-center mt-4">
                        <a href="{% url 'news:news_list' %}" class="btn">Voir tous les événements</a>
                    </div>
                {% elif section.section_type == 'theologie' %}
                    <div class="text-center mt-4">
                        <a href="{% url 'theology:theology_list' %}" class="btn">Voir tous les cours</a>
                    </div>
                {% endif %}
            </section>
        {% endfor %}
    </div>
{% endblock %}

{% block extra_js %}
    <script>
        // Custom carousel code for homepage if needed
    </script>
{% endblock %}
